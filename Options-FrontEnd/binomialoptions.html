<!DOCTYPE html>

<html lang = "en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name = "Author" content = "Gleb Sokhin">
  <title> Options | Binomial Theory </title>
  <link href = "styles.css" rel = "stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link href = "/img/DeltaLogo.png" rel = "icon">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
  />

  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
  ></script>


  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body);"
  ></script>
</head>

<body class="bg-gradient-to-br from-slate-950 via-slate-900 to-zinc-900 text-zinc-100 font-sans">

    <header class="border-b border-zinc-800/50 backdrop-blur sticky top-0 z-40">
    <nav aria-label="primary-nav" class="max-w-6xl mx-auto px-8 py-5">
      <ul class="flex gap-8 text-sm tracking-wide justify-center text-zinc-400">
        <li><a href="index.html" class="hover:text-white transition">Home</a></li>
        <li><a href="binomialoptions.html" class="text-emerald-400">Binomial Options Theory</a></li>
        <li><a href = "greeks.html" class = "hover:text-white transition">The Greeks</a></li>
        <li><a href="binomialoptionsdemo.html" class="hover:text-white transition">Demo</a></li>
        <li><a href="blackscholesoption.html" class="hover:text-white transition">Black–Scholes Options</a></li>
      </ul>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-8 py-20">

    <!-- PAGE TITLE -->
    <section class="mb-24 text-center">
      <h1 class="text-6xl font-bold tracking-tight bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent mb-4">
        Binomial Options Theory
      </h1>
      <p class="text-lg text-zinc-400 max-w-2xl mx-auto leading-relaxed">
        Theory from the ground up. 
      </p>
    </section>

    <!-- TABLE OF CONTENTS -->
    <section class="mb-24 p-8 rounded-xl bg-zinc-900/40 border border-zinc-800/50">
      <h2 class="text-2xl font-semibold mb-6 text-zinc-100">
        Table of Contents
      </h2>
      <ol class="space-y-3 pl-8 list-decimal text-zinc-300">
      <li><a href = "#introduction">Introduction</a></li>
      <li><a href = "#core-concepts">Core Concepts</a></li>
      <li><a href = "#Forward-Binary-Tree">Forward Binary Tree</a></li>
      <li>
        <a href = "#Backward Induction">Backward Induction Tree</a>
        <ul class="mt-2 pl-6 list-disc text-zinc-400 space-y-1">
          <li><a href = "#European Options">European Options</a></li>
          <li><a href = "#American Option">American Options</a></li>
        </ul>
      </li>
      <li><a href = "#Conclusion & Takeaway">Conclusion & Takeaway</a></li>
      <li> <a href = "#Further Comments">Further Comments</a>
      <ul class="mt-2 pl-6 list-disc text-zinc-400 space-y-1">
          <li><a href = "#Outlooks">Outlooks</a></li>
          <li><a href = "#Remarks">Remarks</a></li>
        </ul>
      </li>
    </ol>
    </section>

    <!-- INTRODUCTION -->
    <section id="introduction" class="mb-24 scroll-mt-[30vh]">
      <h2 class="text-3xl font-semibold mb-6 text-zinc-100 border-b border-zinc-800/50 pb-4">
        Introduction
      </h2>
      <p class="text-lg leading-relaxed text-zinc-300 max-w-4xl">
        The Binomial Model provides a method to determine an option's fair price in
        present value by projecting future price movements of an underlying asset
        over a discrete amount of time. In its simplest form, the model assumes the
        asset price can move in only two directions -- up or down -- by a fixed magnitude.
      </p>
    </section>

    <!-- CORE CONCEPTS -->
    <section id="core-concepts" class="mb-24 scroll-mt-[30vh]">
      <h2 class="text-3xl font-semibold mb-8 text-zinc-100 border-b border-zinc-800/50 pb-4"> Core Concepts </h2>

      <h3 class="text-xl font-semibold mb-6 text-emerald-300">
        Five Key Components
      </h3>
      <ul class="space-y-4 pl-8 list-disc text-zinc-300 max-w-4xl">
      <li>
        Beginning Asset Value
        <span class="text-zinc-400">(S)</span>
      </li>

      <li>
        Up Move Factor
        <span class="text-zinc-400">(U)</span> → the proportional gain when the asset
        price increases.
      </li>

      <li>
        Down Move Factor
        <span class="text-zinc-400">(D)</span> → the proportional loss when the asset
        price decreases, often defined as
        <span class="math inline">\(D = \frac{1}{U}\)</span>.
      </li>

      <li>
        Strike Price
        <span class="text-zinc-400">(Sₖ)</span> → the price at which the option may be exercised.
      </li>

      <li>
        Risk-Free Rate
        <span class="text-zinc-400">(r)</span> → a guaranteed rate of return with no risk.
      </li>
    </ul>

    <div class="mt-10 p-6 rounded-xl bg-blue-950/20 border border-blue-900/30 backdrop-blur">
      <h4 class="font-semibold text-blue-300 mb-3">Note</h4>
      <p class="text-zinc-300 leading-relaxed text-sm">
        Although it may seem intuitive to assign probabilities to upward or downward
        price movements, we will later show that the option’s fair price is determined
        independently of real-world probabilities due to arbitrage considerations.
      </p>
    </div>
    </section>

    <!-- FORWARD BINOMIAL TREE -->
    <section class="mb-24 scroll-mt-[30vh]" id = "Forward-Binary-Tree">
      <h2 class="text-3xl font-semibold mb-8 text-zinc-100 border-b border-zinc-800/50 pb-4">Forward Binomial Tree</h2>

      <p class="text-zinc-300 max-w-3xl mb-10 text-lg leading-relaxed">
        Say the current stock price is \(P_0\) at time \(T_0\). From this point, it can only move up or down at the next time step \(T_1\). We model this by adding two child nodes:
        <br /><br />
        <span class="math inline">\(\text{Up} = P_0 \times U\)</span>
        <br />
        <span class="math inline">\(\text{Down} = P_0 \times D\)</span>
        <br /><br />
        This process repeats recursively until expiration.
      </p>

      <!-- Tree -->
      <div class="flex justify-center gap-20 example-tree p-10 rounded-xl bg-zinc-900/30 border border-zinc-800/40 mb-8">
    <div class="flex flex-col justify-center">
      <div class="node node-active">
        <span class="font-mono">P₀</span>
      </div>
    </div>

    <div class="flex flex-col gap-6 justify-center">
      <div class="node node-up">
        <span class="font-mono">P₀</span>
        <span class="text-xs text-zinc-400">× U</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">P₀</span>
        <span class="text-xs text-zinc-400">× D</span>
      </div>
    </div>
  </div>
</section>


<!-- EXAMPLE -->
<section class="my-20">
  <h2 class="text-3xl font-semibold mb-4">Example</h2>

  <p class="text-zinc-400 mb-8">
    If we set <span class="font-mono">iterations = 2</span>,
    <span class="font-mono">U = 1.1</span>,
    and <span class="font-mono">D = 0.9</span>, the tree looks like:
      </p>

      <div class="flex justify-center gap-20 example-tree p-10 rounded-xl bg-zinc-900/30 border border-zinc-800/40">
        <!-- Step 0 -->
    <div class="flex flex-col justify-center">
      <div class="node node-active">
        <span class="font-mono">100.00</span>
      </div>
    </div>

    <!-- Step 1 -->
    <div class="flex flex-col gap-6 justify-center">
      <div class="node node-up">
        <span class="font-mono">110.00</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">90.91</span>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="flex flex-col gap-6">
      <div class="node node-up">
        <span class="font-mono">121.00</span>
      </div>
      <div class="node">
        <span class="font-mono">100.00</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">82.64</span>
      </div>
      </div>
    </div>
    </div>
    </section>



    <!-- BACKWARD INDUCTION -->
    <section class="mb-24 ">
      <h2 class="text-3xl font-semibold mb-8 text-zinc-100 border-b border-zinc-800/50 pb-4 scroll-mt-[30vh]" id="Backward Induction" >Backward Induction</h2>
      <article>
        <h3 class="text-2xl font-semibold mb-6 text-emerald-300 scroll-mt-[30vh]" id = "European Options">European Options</h3>

        <p class="text-zinc-300 max-w-3xl mb-8 text-lg">
          At expiration, each <strong>terminal node</strong> has a payoff. Using
          these payoffs, we determine the fair option price today by working
          backward through the tree. Given these payoffs, we want to ask, what is the fair price of the option today?
        </p>

        <h4 class="text-xl font-semibold mb-4 mt-8 text-zinc-200">Step 1: Calculate the Payoffs</h4>
        <p class="text-zinc-300 max-w-3xl mb-8 text-lg">
          For a Call option:

            <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30">
              <span class="math display">$$\text{Payoff} = \max(0,\; S - S_k)$$</span>
            </div>
        </p>
        <p class ="text-zinc-300 max-w-3xl mb-8 text-lg">
            For a Put option:: 
            <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30">
              <span class="math display">$$\text{Payoff} = \max(0,\; S_k - S)$$</span>
            </div>
          </p>

        <h4 class="text-xl font-semibold mb-4 mt-8 text-zinc-200">Step 2: Work Backward</h4>
        <p class="text-zinc-300 max-w-3xl mb-6 text-lg">
          At an earlier node (the parent of the two children), we compute the
          <strong>discounted expected value</strong> of the option:
        </p>

        <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30">
          <span class="math display">$$V_{\text{current}} = e^{-r\,\Delta t}\left(pV_{\text{up}} + (1-p)V_{\text{down}}\right)$$</span>
        </div>

        <p class="text-zinc-300 max-w-3xl mb-6 text-lg">
          Where:
          <br /> \(r\) is the risk-free rate
          <br /> \(\Delta t\) is the time step
          <br /> \(p\) is the risk-neutral probability
        </p>


        <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30">
              <span class="math display">$$ p = \frac{e^{r \cdot \Delta t} - D}{U - D} $$</span>
        </div>
        <p class="text-zinc-300 mt-6 text-lg">
          Note that instead of real-world probabilities, we use the risk-neutral
          probability. This ensures <strong><a href = "https://www.youtube.com/watch?v=fZa75q5Fkkk%5C" target="_blank" class = "text-orange-400">no arbitrage</a></strong> -- there is no way
          to make a riskless profit by combining stocks and options. 
        </p>

        <p class="text-zinc-300 mt-6 text-lg"> Although it may be complicated, it'll be easier to understand once broken down. Inside the formula, it'll look identical as if you were to compute the regular expected value of the option, 
          except we used risk-neutral probability instead of up and down probabilities.</p>

          <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30">
               <span class = "math display">$$V_{current} = (p_{up} \cdot V_{\text{up}} + (1-p_{down}) \cdot V_{\text{down}})$$</span>
          </div>
       
        <p> The factor being multiplied by the expected value (<span class="math inline">\( e^{-r \Delta t} \)</span>) is the discount factor. Since money is flowing from the future and closer to the present day, we must <strong><a href = "https://en.wikipedia.org/wiki/Time_value_of_money" target = "_blank" class = "text-orange-400">discount</a></strong> it so that it is equivalent in value. </p>

        <p class="text-zinc-300 mt-6 text-lg">
          We'll repeat the backward induction until we reach the root node, which
          yields the fair option price today.
        </p>

        <h3 class="text-2xl font-semibold my-8 text-zinc-100">Example</h3>
        <p class="text-zinc-300 mb-6 text-lg">
          <span class="text-yellow-300 font-mono text-sm">Iterations = 2 | U = 1.1 | D = 0.9 | Risk-free rate = 0.03 | Strike = 102 | Call option = True</span>
        </p>

        <div class="flex justify-center gap-20 example-tree p-10 rounded-xl bg-zinc-900/30 border border-zinc-800/40 mb-8 mt-8">
    <!-- Step 0 -->
    <div class="flex flex-col justify-center">
      <div class="node node-active">
        <span class="font-mono">7.19</span>
      </div>
    </div>

    <!-- Step 1 -->
    <div class="flex flex-col gap-6 justify-center">
      <div class="node node-up">
        <span class="font-mono">12.08</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">2.10</span>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="flex flex-col gap-6">
      <div class="node node-up">
        <span class="font-mono">19.76</span>
      </div>
      <div class="node">
        <span class="font-mono">4.09</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">0.00</span>
      </div>
          </div>
        </div>
        </div>
      </article>

      <article class="mt-16 pt-8 border-t border-zinc-800/50">
        <h3 class="text-2xl font-semibold mb-6 text-emerald-300 scroll-mt-[30vh]" id = "American Option">American Options</h3>
        <h4 class="text-xl font-semibold mb-4 text-zinc-200">Key Differences</h4>
        <p class="text-zinc-300 text-lg mb-6">
          Whereas European options are exercised only at expiration, American
          options can be exercised any time during their lifetime. Overall, this generally provides flexibility as the option can be exercised at any time to potentially achieve a greater profit (or loss).
        </p>

        <h4 class="text-xl font-semibold mb-4 mt-8 text-zinc-200">Calculations</h4>
        <p class="text-zinc-300 text-lg">
          At each node at time <span class = "math inline">T</span>, there are two possibilities: exercising the option immediately or holding it for another time step. 
          The value of exercising immediately is called the immediate exercise value (<span class="math inline">\(IEV_t\)</span>) which is simply the payoff at that moment: </p>
        <br></br>
        <p class="text-zinc-300 text-lg my-4">
          For a Call option:
          <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30 text-center">
              <span class="math display">\( IEV_t = \max(0, S - S_k) \)</span>
          </div>
          
        </p>

        <p class="text-zinc-300 text-lg my-4">
          For a Put option:
          <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30 text-center">
              <span class="math display">\( IEV_t = \max(0, S_k - S) \)</span>
          </div>

        </p>

        <br />

        <p class="text-zinc-300 text-lg">
          If the option is not exercised, we assigned its value to the discount expected value of its future payoffs.
          This is known as continuation value (<span class="math inline">\( CV_t \)</span>)
        </p>
        
        <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30 text-center">
              <span class="math display">
                \[
                CV_t = e^{-r \Delta t}\left(p V_{\text{up}} + (1 - p) V_{\text{down}}\right)
                \]
            </span>
          </div>

        <p class = "text-zinc-300 text-lg"> The option at time <span class = "math inline">T</span> has two possible values. We choose higher of the two because anything else would create an arbitrage opportunities (See Arbitrage Example down below):</p>

        <div class="my-8 p-6 rounded-lg bg-zinc-900/50 border border-zinc-800/30 text-center">
              <span class = "math display">$$V_t = max(IET_t, CV_t)$$ </span>
          </div>
        

        <h3 class="text-2xl font-semibold my-8 text-zinc-100">Arbitrage Example</h3>
        <p class="text-zinc-300 text-lg mb-8">
          Say we had a scenario where we did not pick the max of the two possibilities: <span class="math inline">\(IEV_t\) = $20</span> and
          <span class="math inline">\(CV_t\) = $15</span>. If the option is
          priced at $15 (or anything lower than the max value, $20), an investor could buy it for $15 and immediately sell it for a risk-free gain of $5. This guaranteed $5 profit violates no-arbitrage, so the option must be worth $20.
        </p>

        <h3 class="text-2xl font-semibold my-8 text-zinc-100">General Example</h3>
        <p class="text-zinc-300 mb-8 text-lg">
          <span class="text-yellow-300 font-mono text-sm">Iterations = 2 | U = 1.1 | D = 0.9 | Risk-free rate = 0.1 | Strike = 102 | Put option (American)</span>
        </p>

        <h4 class="text-lg font-semibold my-6 text-zinc-200">Underlying Asset Price Action</h4>
        <div class="flex justify-center gap-20 example-tree p-10 rounded-xl bg-zinc-900/30 border border-zinc-800/40 mb-8 mt-6">
    <!-- Step 0 -->
    <div class="flex flex-col justify-center">
      <div class="node node-active">
        <span class="font-mono">100.00</span>
      </div>
    </div>

    <!-- Step 1 -->
    <div class="flex flex-col gap-6 justify-center">
      <div class="node node-up">
        <span class="font-mono">110.00</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">90.91</span>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="flex flex-col gap-6">
      <div class="node node-up">
        <span class="font-mono">121.00</span>
      </div>
      <div class="node">
        <span class="font-mono">100.00</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">82.64</span>
      </div>
    </div>
      </div>
      <h4 class="text-lg font-semibold my-6 text-zinc-200" >American Option</h4>
      <div class="flex justify-center gap-20 example-tree p-10 rounded-xl bg-zinc-900/30 border border-zinc-800/40 mb-8">
    <!-- Step 0 -->
    <div class="flex flex-col justify-center">
      <div class="node node-active">
        <span class="font-mono">5.19</span>
      </div>
    </div>

    <!-- Step 1 -->
    <div class="flex flex-col gap-6 justify-center">
      <div class="node node-up">
        <span class="font-mono">1.61</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">11.09</span>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="flex flex-col gap-6">
      <div class="node node-up">
        <span class="font-mono">0.00</span>
      </div>
      <div class="node">
        <span class="font-mono">4.23</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">19.36</span>
      </div>
    </div>
      </div>
      <h4 class="text-lg font-semibold my-6 text-zinc-200">European Option (for comparison)</h4>
      <div class="flex justify-center gap-20 example-tree p-10 rounded-xl bg-zinc-900/30 border border-zinc-800/40 mb-8">
    <!-- Step 0 -->
    <div class="flex flex-col justify-center">
      <div class="node node-active">
        <span class="font-mono">4.37</span>
      </div>
    </div>

    <!-- Step 1 -->
    <div class="flex flex-col gap-6 justify-center">
      <div class="node node-up">
        <span class="font-mono">1.61</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">8.94</span>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="flex flex-col gap-6">
      <div class="node node-up">
        <span class="font-mono">0.00</span>
      </div>
      <div class="node">
        <span class="font-mono">4.23</span>
      </div>
      <div class="node node-down">
        <span class="font-mono">16.84</span>
      </div>
        </div>
      </div>
      </div>
      </article>
    </section>

    <!--Conclusion-->
  <section>
    <h2 class="text-3xl font-semibold mb-8 text-zinc-100 border-b border-zinc-800/50 pb-4 scroll-mt-[30vh]" id = "Conclusion & Takeaway">Conclusion & Takeaway</h2>
    <p>The Binomial Model combines two integral components of finance together -- time value of money and risk neutrality -- to determine a fair price for an option.

        One of my biggest takeaways was the absence of upward and downward probabilities: Regardless of the chances of the stock going up or down, the price of the option will be the same. Another way to look at it is we're pricing the volatility of the underlying asset. Intuitively, it makes sense, since market makers need to be hedged against up or down movement -- they don't profit off of guessing price direction, but from ensuring a fair and riskless price. 

        Another key insight was the concept of arbitrage; It gave me perspective on how options are priced in from a market maker's standpoint. It also showed me how there is no free lunch in a free, efficient market. I'm curious to see how other instruments are priced in with arbitrage, and if there are any limitations to this approach.</p>
  </section>

  <!--Further Comments-->
  <section>
      <h2 class="text-3xl font-semibold my-8 text-zinc-100 border-b border-zinc-800/50 pb-4 scroll-mt-[30vh]" id = "Further Comments">Further Comments</h2>
      <div>
        <h3 class="text-2xl font-semibold mb-6 text-emerald-300 scroll-mt-[30vh]" id ="Outlooks">Outlooks</h3>
        <p>Since the Black-Scholes model can be derived from the binary options model, I may consider tackling it in the future. I may also consider doing more complex operations,such as computational approach to determining the volatility, U. <br>From a trading perspective, I may also consider applying the binary options model to the live market to see how well the model does in practice.  </p>
      </div>
      <div>
        <h3 class="text-2xl font-semibold mb-6 text-emerald-300 mt-4 scroll-mt-[30vh]" id = "Remarks">Remarks</h3>
        <p>I'd like to thank my finance professor, <a href = "https://www.isenberg.umass.edu/people/sara-smiarowski" target="_blank" class = "text-orange-400">Sara Smiarowski</a>, for introducing me to this topic. I'm very grateful for her guidance.
          I'd also like to thank my statistics professor, <a href = "https://www.umass.edu/mathematics-statistics/about/directory/mike-sullivan" target="_blank" class ="text-orange-400">Mike Sullivan</a>, for not only deriving but explaining the mathematical components behind the binomial model. I'm very grateful for his assistance.

          If you have any comments, suggestions, or questions, feel free to reach out to me at gsokhin@umass.edu.</p>
      </div>
    </section>
  </main>

<footer class="border-t border-zinc-800/50 mt-20 bg-zinc-900/30">
    <div class="max-w-6xl mx-auto px-8 py-12 flex flex-col sm:flex-row items-center justify-between gap-8">
      <div class="flex flex-col items-center sm:items-start gap-4">
        <div class="text-sm text-zinc-400 tracking-wide">
          © 2026 Gleb Sokhin
        </div>
        <div class="flex gap-4">
          <a href="https://glebquant.netlify.app/" target="_blank" class="transition hover:opacity-80"><img src="/img/sigmaicon.png" width="50px" alt="Portfolio"></a>
          <a href="https://www.linkedin.com/in/gleb-sokhin/" target="_blank" class="transition hover:opacity-80"><img src="/img/linkedinlogo.png" width="50px" alt="LinkedIn"></a>
          <a href="https://github.com/Student-of-Python" target="_blank" class="transition hover:opacity-80"><img src="/img/githublogo.png" width="50px" alt="GitHub"></a>
        </div>
      </div>
        
      <nav class="flex gap-6 text-sm tracking-wide text-zinc-400">
        <a href="index.html" class="hover:text-white transition">Home</a>
        <a href="binomialoptions.html" class="text-emerald-400">Theory</a>
        <a href="binomialoptionsdemo.html" class="hover:text-white transition">Demo</a>
      </nav>
    </div>
  </footer>

  <script>
    // Draw connecting lines for static example trees.
    (function drawExampleTreeLines(){
      function drawFor(container){
        // create svg overlay
        const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
        svg.setAttribute('aria-hidden','true');
        container.style.position = container.style.position || 'relative';
        container.prepend(svg);

        const cols = Array.from(container.children).filter(c => c.classList && c.classList.contains('flex'));
        // If the structure is nested (columns are immediate children), but sometimes there are wrappers; fallback below
        const columns = cols.length ? cols : Array.from(container.querySelectorAll(':scope > div'));

        const levels = columns.map(col => Array.from(col.querySelectorAll('.node')));
        if (levels.length < 2) return;

        // sync svg size
        const rect = container.getBoundingClientRect();
        svg.setAttribute('width', rect.width);
        svg.setAttribute('height', rect.height);
        svg.style.position = 'absolute'; svg.style.left='0'; svg.style.top='0'; svg.style.width='100%'; svg.style.height='100%';

        // helper to get center point relative to container
        function center(el){
          const r = el.getBoundingClientRect();
          return { x: r.left + r.width/2 - rect.left, y: r.top + r.height/2 - rect.top };
        }

        for (let lvl = 0; lvl < levels.length - 1; lvl++){
          const parents = levels[lvl];
          const children = levels[lvl+1];
          parents.forEach((p, idx) => {
            const leftChild = children[idx];
            const rightChild = children[idx+1];
            if (!leftChild && !rightChild) return;
            const pc = center(p);
            [leftChild, rightChild].forEach(c => {
              if (!c) return;
              const cc = center(c);
              const line = document.createElementNS('http://www.w3.org/2000/svg','line');
              line.setAttribute('x1', pc.x); line.setAttribute('y1', pc.y);
              line.setAttribute('x2', cc.x); line.setAttribute('y2', cc.y);
              line.setAttribute('stroke','#6b7280'); line.setAttribute('stroke-width','2');
              svg.appendChild(line);
            });
          });
        }
      }

      // find all marked example-tree containers
      document.addEventListener('DOMContentLoaded', ()=>{
        document.querySelectorAll('.example-tree').forEach(container => {
          try { drawFor(container); } catch(e){ console.warn('drawExampleTreeLines failed', e); }
        });
      });
    })();
  </script>
</body>



</html>